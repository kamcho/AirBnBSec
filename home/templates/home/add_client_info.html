{% extends 'users/base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-900 py-8 px-4 sm:px-6 lg:px-8 transition-colors duration-200">
    <div class="max-w-3xl mx-auto">
        <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden border border-gray-700">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-900 via-blue-800 to-cyan-800 px-6 py-5 sm:px-8 border-b border-blue-700">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-white">Add Client Information</h2>
                        <p class="mt-1 text-sm text-blue-200">Please fill in the client's details below</p>
                    </div>
                    <div class="bg-blue-600 text-white rounded-full p-2 shadow-lg">
                        <i class="fas fa-user-plus text-xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- Form -->
            <div class="px-6 py-8 sm:px-10">
                <form method="post" id="clientInfoForm" enctype="multipart/form-data" class="space-y-6">
                    {% csrf_token %}
                    <input type="hidden" name="incident_id" value="{{ incident.id }}">
                    
                    <!-- Personal Information Section -->
                    <div class="border-b border-gray-700 pb-6">
                        <h3 class="text-lg font-medium text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-user-circle text-blue-500 mr-3"></i>
                            Personal Information
                        </h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                            <div class="sm:col-span-3">
                                <label for="id_first_name" class="block text-sm font-medium text-gray-300">
                                    First Name <span class="text-red-400">*</span>
                                </label>
                                <div class="mt-1">
                                    <input type="text" id="id_first_name" name="first_name" required
                                        class="block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3 border">
                                </div>
                            </div>
                            
                            <div class="sm:col-span-3">
                                <label for="id_last_name" class="block text-sm font-medium text-gray-300">
                                    Last Name
                                </label>
                                <div class="mt-1">
                                    <input type="text" id="id_last_name" name="last_name"
                                        class="block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3 border">
                                </div>
                            </div>
                            
                            <div class="sm:col-span-6">
                                <label for="id_id_number" class="block text-sm font-medium text-gray-300">
                                    ID/Passport Number
                                </label>
                                <div class="mt-1">
                                    <input type="text" id="id_id_number" name="id_number"
                                        class="block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3 border">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Information Section -->
                    <div class="border-b border-gray-700 pb-6">
                        <h3 class="text-lg font-medium text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-address-card text-blue-500 mr-3"></i>
                            Contact Information
                        </h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                            <div class="sm:col-span-4">
                                <label for="id_email" class="block text-sm font-medium text-gray-300">
                                    Email Address <span class="text-red-400">*</span>
                                </label>
                                <div class="mt-1">
                                    <input type="email" id="id_email" name="email" 
                                        class="block w-full rounded-md bg-gray-700 border-gray-600 text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm py-2.5 px-3 border">
                                </div>
                            </div>
                            
                            <div class="sm:col-span-4">
                                <label for="id_phone" class="block text-sm font-medium text-gray-300">
                                    Phone Number <span class="text-red-400">*</span>
                                </label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-600 bg-gray-700 text-gray-300 text-sm">
                                        +254
                                    </span>
                                    <input type="tel" id="id_phone" name="phone" required
                                        pattern="[0-9]{9}" 
                                        title="Please enter a valid 9-digit phone number"
                                        class="flex-1 min-w-0 block w-full px-3 py-2.5 rounded-none rounded-r-md bg-gray-700 border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500 sm:text-sm border">
                                </div>
                                <p class="mt-1 text-xs text-gray-400">Enter 9 digits (e.g., 712345678)</p>
                            </div>
                            
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="flex items-center justify-end space-x-3 pt-6">
                        <a href="{% url 'home:incident_detail' pk=incident.id %}" 
                           class="inline-flex items-center px-4 py-2 border border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-200 bg-gray-700 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                            <i class="fas fa-times mr-2"></i> Cancel
                        </a>
                        <button type="submit" 
                                class="inline-flex items-center px-6 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 hover:shadow-lg">
                            <i class="fas fa-save mr-2"></i> Save Client
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Help Text -->
        <div class="mt-6 bg-blue-900/30 border-l-4 border-blue-500 p-4 rounded-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-blue-400 text-xl"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-blue-200">
                        <span class="font-medium">Note:</span> Fields marked with <span class="text-red-400">*</span> are required.
                        Please ensure all information is accurate before submitting.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Form Validation Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('clientInfoForm');
    const phoneInput = document.getElementById('id_phone');
    
    // Format phone number on blur
    phoneInput.addEventListener('blur', function() {
        let phone = this.value.replace(/\D/g, '');
        if (phone.length === 9 && !phone.startsWith('0')) {
            this.value = phone;
        } else if (phone.length === 10 && phone.startsWith('0')) {
            this.value = phone.substring(1);
        } else if (phone.length === 12 && phone.startsWith('254')) {
            this.value = phone.substring(3);
        }
    });
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        const phone = phoneInput.value.replace(/\D/g, '');
        
        if (phone && !/^[0-9]{9}$/.test(phone)) {
            e.preventDefault();
            alert('Please enter a valid 9-digit phone number (without +254)');
            phoneInput.focus();
            return false;
        }
        return true;
    });
});
</script>

<style>
/* Custom styles for better form appearance */
input[type="text"],
input[type="email"],
input[type="tel"],
textarea,
select {
    transition: all 0.2s ease-in-out;
    background-color: #374151 !important;
    color: #f3f4f6 !important;
}

input[type="text"]:focus,
input[type="email"]:focus,
input[type="tel"]:focus,
textarea:focus,
select:focus {
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3) !important;
    background-color: #1f2937 !important;
}

/* Button hover effects */
.btn-primary {
    transition: all 0.2s ease-in-out;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px -1px rgba(0, 0, 0, 0.3);
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #1f2937;
}

::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
}

/* Responsive adjustments */
@media (max-width: 640px) {
    .sm\:grid-cols-6 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    
    .card {
        margin: 0 -1rem;
        border-radius: 0;
    }
}

/* Input placeholder color */
::placeholder {
    color: #9ca3af !important;
    opacity: 1;
}

:-ms-input-placeholder {
    color: #9ca3af !important;
}

::-ms-input-placeholder {
    color: #9ca3af !important;
}

/* Focus ring customization */
*:focus {
    outline: none;
    --tw-ring-color: rgba(59, 130, 246, 0.5) !important;
}
</style>
{% endblock %}
