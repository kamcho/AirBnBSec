{% extends 'users/base.html' %}
{% load static %}

{% block title %}Security Dashboard - AirBnBSec{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #3b82f6;
        --primary-light: #60a5fa;
        --secondary: #6b7280;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --dark: #1f2937;
        --light: #f3f4f6;
        --gray-100: #f9fafb;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
    }

    body {
        background-color: #0f172a;
        color: #e2e8f0;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.5;
    }

    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
        position: relative;
        padding: 2rem 0;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
        border-radius: 1rem;
        border: 1px solid rgba(99, 102, 241, 0.2);
        box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.2);
        overflow: hidden;
    }

    .dashboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        background-size: 200% 200%;
        animation: gradientBG 8s ease infinite;
    }

    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 800;
        color: #ffffff;
        margin: 0 0 0.75rem 0;
        background: linear-gradient(90deg, #ffffff, #e0e7ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.5px;
        position: relative;
        display: inline-block;
        padding: 0 1.5rem;
    }

    .dashboard-subtitle {
        color: #a5b4fc;
        font-size: 1.25rem;
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.6;
        font-weight: 400;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        text-align: center;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        border-color: #3b82f6;
    }

    .stat-icon {
        width: 3rem;
        height: 3rem;
        margin: 0 auto 1rem;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #f8fafc;
        margin-bottom: 0.25rem;
    }

    .stat-label {
        color: #94a3b8;
        font-size: 0.875rem;
    }

    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }
    
    .chart-section {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 0;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .chart-section:hover {
        border-color: #3b82f6;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
    }

    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #e2e8f0;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        margin: 0 auto;
        padding: 0.5rem;
    }
    
    /* Ensure chart canvas takes full container */
    .chart-container canvas {
        width: 100% !important;
        height: 100% !important;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .dashboard-title {
            font-size: 2rem;
            padding: 0 1rem;
        }
        
        .dashboard-subtitle {
            font-size: 1.1rem;
            padding: 0 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
        <!-- Header Section -->
        <header class="dashboard-header">
            <div class="container">
                <h1 class="dashboard-title">Security Dashboard</h1>
                <p class="dashboard-subtitle">
                    <i data-lucide="shield" class="inline-icon"></i>
                    Monitor and analyze security incidents across all properties in real-time
                </p>
            </div>
        </header>

    <!-- Stats Overview Section -->
    <section class="stats-overview">
        <h2 class="section-title">Overview</h2>
        <div class="stats-grid">
            <!-- Stat Card 1 -->
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #dbeafe; color: #3b82f6;">
                    <i data-lucide="alert-circle"></i>
                </div>
                <div class="stat-value">24</div>
                <div class="stat-label">Total Incidents</div>
            </div>

            <!-- Stat Card 2 -->
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #fef3c7; color: #f59e0b;">
                    <i data-lucide="alert-triangle"></i>
                </div>
                <div class="stat-value">8</div>
                <div class="stat-label">Active Incidents</div>
            </div>

            <!-- Stat Card 3 -->
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #dcfce7; color: #10b981;">
                    <i data-lucide="check-circle"></i>
                </div>
                <div class="stat-value">15</div>
                <div class="stat-label">Resolved</div>
            </div>

            <!-- Stat Card 4 -->
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #fee2e2; color: #ef4444;">
                    <i data-lucide="alert-octagon"></i>
                </div>
                <div class="stat-value">1</div>
                <div class="stat-label">Critical</div>
            </div>
        </div>
    </section>

    <!-- Charts Section -->
    <section class="charts-section">
        <!-- Main Trends Chart -->
        <div class="chart-section">
            <h2 class="section-title">
                <i data-lucide="bar-chart-3"></i>
                Monthly Incident Trends
            </h2>
            <div class="chart-container">
                <canvas id="monthlyTrendsChart"></canvas>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Incident Types Pie Chart -->
            <div class="chart-section">
                <h2 class="section-title">
                    <i data-lucide="pie-chart"></i>
                    Incident Types
                </h2>
                <div class="chart-container">
                    <canvas id="incidentTypesChart"></canvas>
                </div>
            </div>

            <!-- Status Distribution Chart -->
            <div class="chart-section">
                <h2 class="section-title">
                    <i data-lucide="activity"></i>
                    Status Overview
                </h2>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>

            <!-- Severity Distribution Bar Chart -->
            <div class="chart-section">
                <h2 class="section-title">
                    <i data-lucide="alert-triangle"></i>
                    Severity Distribution
                </h2>
                <div class="chart-container">
                    <canvas id="severityChart"></canvas>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Include Lucide Icons and Chart.js -->
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Initialize Lucide Icons
    lucide.createIcons();

    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Chart.js global configuration
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
        Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, sans-serif";
        
        // Monthly Trends Chart
        const monthlyTrendsCtx = document.getElementById('monthlyTrendsChart').getContext('2d');
        
        // Sample data - replace with your actual data
        const monthlyData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            datasets: [{
                label: 'Security Incidents',
                data: [12, 19, 15, 8, 11, 14, 9],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                borderWidth: 2,
                tension: 0.3,
                fill: true,
                pointBackgroundColor: '#1e293b',
                pointBorderColor: '#3b82f6',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        };

        // Create the chart
        const monthlyTrendsChart = new Chart(monthlyTrendsCtx, {
            type: 'line',
            data: monthlyData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        borderColor: '#334155',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return `Incidents: ${context.parsed.y}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8',
                            precision: 0
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // Incident Types Pie Chart
        const incidentTypesCtx = document.getElementById('incidentTypesChart').getContext('2d');
        const incidentTypesData = {
            labels: [
                'Fraud Attempt',
                'Unauthorized Access',
                'Property Damage',
                'Suspicious Activity',
                'Verification Failure',
                'Payment Fraud',
                'Identity Theft',
                'Harassment',
                'Noise Complaint',
                'Other'
            ],
            datasets: [{
                data: [15, 20, 18, 12, 8, 10, 5, 7, 3, 2],  // Sample data - replace with actual counts
                backgroundColor: [
                    '#3b82f6',  // Blue
                    '#10b981',  // Green
                    '#f59e0b',  // Amber
                    '#ef4444',  // Red
                    '#8b5cf6',  // Purple
                    '#ec4899',  // Pink
                    '#06b6d4',  // Cyan
                    '#84cc16',  // Lime
                    '#f97316',  // Orange
                    '#64748b'   // Slate
                ],
                borderWidth: 0,
                hoverOffset: 10
            }]
        };

        const incidentTypesChart = new Chart(incidentTypesCtx, {
            type: 'doughnut',
            data: incidentTypesData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#94a3b8',
                            padding: 12,
                            usePointStyle: true,
                            pointStyle: 'circle',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        borderColor: '#334155',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Severity Distribution Bar Chart
        const severityCtx = document.getElementById('severityChart').getContext('2d');
        const severityData = {
            labels: ['Low', 'Medium', 'High', 'Critical'],
            datasets: [{
                label: 'Incidents',
                data: [45, 30, 15, 10],
                backgroundColor: [
                    'rgba(16, 185, 129, 0.8)',    // Green
                    'rgba(245, 158, 11, 0.8)',    // Amber
                    'rgba(239, 68, 68, 0.8)',     // Red
                    'rgba(139, 92, 246, 0.8)'     // Purple
                ],
                borderColor: [
                    'rgba(16, 185, 129, 1)',
                    'rgba(245, 158, 11, 1)',
                    'rgba(239, 68, 68, 1)',
                    'rgba(139, 92, 246, 1)'
                ],
                borderWidth: 1,
                borderRadius: 4
            }]
        };

        const severityChart = new Chart(severityCtx, {
            type: 'bar',
            data: severityData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        borderColor: '#334155',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return `Incidents: ${context.parsed.y}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#94a3b8',
                            precision: 0
                        }
                    }
                }
            }
        });

        // Status Distribution Chart
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        const statusData = {
            labels: ['Reported', 'In Progress', 'Escalated', 'Resolved', 'Closed'],
            datasets: [{
                data: [25, 15, 10, 35, 15],
                backgroundColor: [
                    '#3b82f6',  // Blue for Reported
                    '#f59e0b',  // Amber for In Progress
                    '#8b5cf6',  // Purple for Escalated
                    '#10b981',  // Green for Resolved
                    '#6b7280'   // Gray for Closed
                ],
                borderWidth: 0,
                hoverOffset: 10,
                spacing: 2
            }]
        };

        const statusChart = new Chart(statusCtx, {
            type: 'doughnut',
            data: statusData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#94a3b8',
                            padding: 8,
                            usePointStyle: true,
                            pointStyle: 'circle',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        borderColor: '#334155',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Add window resize event listeners for all charts
        const charts = [monthlyTrendsChart, incidentTypesChart, severityChart, statusChart];
        window.addEventListener('resize', function() {
            charts.forEach(chart => chart.resize());
        });
    });
</script>
{% endblock %}