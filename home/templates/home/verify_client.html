{% extends 'users/base.html' %}
{% load static %}

{% block title %}ID Verification - AirBnBSec{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    .main-content {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        min-height: calc(100vh - 4rem);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2.625rem 1rem 2rem; /* Added 10px (0.625rem) to top padding */
        width: 100%;
    }
    
    .verification-container {
        width: 100%;
        max-width: 500px;
        background: rgba(17, 24, 39, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2.5rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        position: relative;
        overflow: hidden;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s ease-out forwards;
    }
    
    .verification-container:hover {
        transform: translateY(-8px) rotateX(0deg);
        box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.5), 
                    0 20px 30px -10px rgba(0, 0, 0, 0.3);
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .verification-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
    }
    
    /* Header styles */
    .verification-header {
        text-align: center;
        margin-bottom: 2.5rem;
        position: relative;
    }
    
    .verification-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .verification-header .icon-container {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
        border-radius: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        position: relative;
    }
    
    @keyframes glow {
        from {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3),
                        0 0 30px rgba(59, 130, 246, 0.1),
                        inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }
        to {
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5),
                        0 0 50px rgba(59, 130, 246, 0.2),
                        inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }
    }
    
    .verification-header .icon-container i {
        font-size: 2.5rem;
        color: white;
        transition: transform 0.3s ease;
    }
    
    .verification-header .icon-container:hover i {
        transform: scale(1.1) rotateY(10deg);
    }
    
    @keyframes float {
        0%, 100% {
            transform: translateY(0) rotateY(0deg);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        50% {
            transform: translateY(-10px) rotateY(5deg);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }
    }
    
    .verification-header h2 {
        color: #fff;
        font-weight: 800;
        margin-bottom: 0.5rem;
        font-size: 1.875rem;
        line-height: 2.25rem;
        background: linear-gradient(to right, #3b82f6, #10b981);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .verification-header p {
        color: #9ca3af;
        font-size: 1rem;
        line-height: 1.625;
        max-width: 28rem;
        margin: 0 auto;
    }
    
    /* Form styles */
    .verification-form {
        max-width: 600px;
        margin: 0 auto;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 600;
        color: #e2e8f0;
        font-size: 1rem;
    }
    
    .form-control {
        width: 100%;
        padding: 0.875rem 1.25rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #f8fafc;
        background-color: rgba(15, 23, 42, 0.7);
        background-clip: padding-box;
        border: 1px solid #334155;
        border-radius: 0.5rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    
    .form-control:focus {
        border-color: #3b82f6;
        outline: 0;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        background-color: rgba(15, 23, 42, 0.9);
    }
    
    .form-control::placeholder {
        color: #64748b;
        opacity: 1;
    }
    
    /* Button styles */
    .btn-verify {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        line-height: 1.5;
        color: white;
        text-align: center;
        text-decoration: none;
        white-space: nowrap;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        border: none;
        border-radius: 0.75rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        width: 100%;
        margin-top: 1.5rem;
        position: relative;
        overflow: hidden;
        transform: translateZ(0);
        box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2), 
                    0 2px 4px -1px rgba(37, 99, 235, 0.1);
    }
    
    .btn-verify:hover {
        transform: translateY(-2px) translateZ(0);
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3), 
                    0 4px 6px -2px rgba(37, 99, 235, 0.15);
    }
    
    .btn-verify:active {
        transform: translateY(0) translateZ(0);
        box-shadow: 0 2px 4px -1px rgba(37, 99, 235, 0.2);
    }
    
    .ripple-effect {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.7);
        transform: scale(0);
        animation: ripple 0.6s linear;
        pointer-events: none;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
    }
    
    @keyframes ripple {
        to {
            transform: scale(20);
            opacity: 0;
        }
    }
    
    .btn-verify:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 
                    0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .btn-verify:active {
        transform: translateY(0);
    }
    
    .btn-verify:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    /* Loading spinner */
    .loading-spinner {
        display: inline-block;
        width: 1.5rem;
        height: 1.5rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 0.5rem;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .verification-container {
            padding: 2rem 1.5rem;
            margin: 1rem;
            max-width: 100%;
        }
        
        .verification-header h2 {
            font-size: 1.75rem;
        }
        
        .verification-header p {
            font-size: 1rem;
        }
    }
    
    /* Form validation styles */
    .errorlist {
        color: #f87171;
        font-size: 0.875rem;
        margin-top: 0.5rem;
        padding-left: 1.25rem;
    }
    
    .errorlist li {
        margin-bottom: 0.25rem;
    }
    
    /* File input styling */
    .file-input-container {
        position: relative;
        margin-top: 0.5rem;
    }
    
    .file-input {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
    }
    
    .file-label {
        display: inline-flex;
        align-items: center;
        padding: 0.75rem 1.25rem;
        background-color: rgba(15, 23, 42, 0.7);
        border: 1px dashed #4b5563;
        border-radius: 0.5rem;
        color: #e2e8f0;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        width: 100%;
        justify-content: center;
    }
    
    .file-label:hover {
        background-color: rgba(15, 23, 42, 0.9);
        border-color: #3b82f6;
    }
    
    .file-label i {
        margin-right: 0.5rem;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .verification-result {
        margin-top: 2rem;
        padding: 1.5rem;
        border-radius: 16px;
        display: none;
        backdrop-filter: blur(10px);
        border: 1px solid;
        animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .verification-success {
        background: rgba(34, 197, 94, 0.1);
        border-color: rgba(34, 197, 94, 0.3);
        color: #22c55e;
    }
    
    .verification-error {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
        color: #ef4444;
    }
    
    .id-format-hint {
        font-size: 0.95rem;
        color: #64748b;
        margin-top: 0.75rem;
        display: flex;
        align-items: center;
        font-weight: 500;
    }
    
    .id-format-hint i {
        margin-right: 0.5rem;
        color: #3b82f6;
    }
    
    .security-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
        color: #22c55e;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 600;
        margin-top: 1.5rem;
        border: 1px solid rgba(34, 197, 94, 0.3);
        box-shadow: 0 4px 15px rgba(34, 197, 94, 0.2);
    }
    
    .security-info {
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 12px;
        padding: 1rem;
        margin-top: 2rem;
        text-align: center;
    }
    
    .security-info small {
        color: #64748b;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .security-info i {
        color: #3b82f6;
    }
    
    .floating-shapes {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        overflow: hidden;
        z-index: 0;
    }
    
    .floating-shapes::before,
    .floating-shapes::after {
        content: '';
        position: absolute;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: linear-gradient(45deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
        animation: float 6s ease-in-out infinite;
    }
    
    .floating-shapes::before {
        top: -100px;
        right: -100px;
        animation-delay: 0s;
    }
    
    .floating-shapes::after {
        bottom: -100px;
        left: -100px;
        animation-delay: 3s;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    .verification-container > * {
        position: relative;
        z-index: 1;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .verification-container {
            margin: 1rem;
            padding: 2rem;
            border-radius: 20px;
        }
        
        .verification-header h2 {
            font-size: 2rem;
        }
        
        .verification-header p {
            font-size: 1rem;
        }
        
        .form-control {
            padding: 1rem 1.25rem;
            font-size: 1.1rem;
        }
        
        .btn-verify {
            padding: 1rem 2rem;
            font-size: 0.95rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="flex justify-center w-full">
    <div class="w-full max-w-md bg-gray-800 rounded-xl shadow-xl overflow-hidden">
        <div class="px-8 py-10">
            <div class="text-center mb-8">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gradient-to-r from-blue-500 to-green-500 mb-4">
                    <i data-lucide="shield-check" class="h-8 w-8 text-white"></i>
                </div>
                <h2 class="text-2xl font-extrabold text-white text-center mb-2">
                    ID Verification
                </h2>
                <p class="text-gray-300 text-center mb-6">Verify your identity to access all features securely</p>
                <div class="w-16 h-1 bg-gradient-to-r from-blue-500 to-green-400 mx-auto mb-6 rounded"></div>
            </div>
            
            <div class="space-y-6">
            {% if verification_success %}
                <div class="verification-result verification-success" id="successResult">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
                        <h5 class="mb-0">Verification Successful!</h5>
                    </div>
                    <p class="mb-3">Your identity has been verified successfully.</p>
                    <div class="security-badge">
                        <i class="bi bi-shield-check"></i>
                        <span>Identity Verified</span>
                    </div>
                    <div class="mt-3">
                        <a href="{% url 'login' %}" class="btn btn-verify">Continue to Dashboard</a>
                    </div>
                </div>
            {% else %}
                <form id="verificationForm" method="post" action="{% url 'home:verify_client' %}">
                    {% csrf_token %}
                    <div class="space-y-2">
                        <label for="idNumber" class="block text-sm font-medium text-gray-300">
                            National ID Number
                        </label>
                        <input type="text" 
                               id="idNumber" 
                               name="id_number"
                               class="block w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Enter your National ID number"
                               pattern="[0-9]{8}"
                               maxlength="8"
                               required>
                        <div class="id-format-hint">
                            <i class="bi bi-info-circle me-1"></i>
                            Enter your 8-digit National ID number (e.g., 12345678)
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label for="phoneNumber" class="block text-sm font-medium text-gray-300">
                            Phone Number (Optional)
                        </label>
                        <input type="tel" 
                               id="phoneNumber" 
                               name="phone_number"
                               class="block w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="+254 7XX XXX XXX"
                               pattern="[0-9+\s-()]+">
                        <div class="id-format-hint">
                            <i class="bi bi-info-circle me-1"></i>
                            Your phone number for additional verification
                        </div>
                    </div>
                    
                    <button type="submit" 
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-green-500 hover:from-blue-600 hover:to-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300"
                            id="verifyBtn">
                        <span class="loading-spinner hidden" id="loadingSpinner"></span>
                        <span id="btnText" class="flex items-center">
                            <i data-lucide="shield-check" class="w-5 h-5 mr-2"></i>Verify Identity
                        </span>
                    </button>
                </form>
                
                <div class="bg-red-900/30 border border-red-800 rounded-lg p-4 hidden" id="errorResult">
                    <div class="flex items-center">
                        <i data-lucide="alert-triangle" class="h-5 w-5 text-red-400 mr-2"></i>
                        <h6 class="font-medium text-red-300">Verification Failed</h6>
                    </div>
                    <p class="mt-1 text-sm text-red-200" id="errorMessage">Please check your ID number and try again.</p>
                </div>
                
                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-400 flex items-center justify-center">
                        <i data-lucide="lock" class="h-4 w-4 mr-1"></i>
                        Your information is secure and encrypted. We use GavaConnect API for verification.
                    </p>
                </div>
            {% endif %}
            </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Lucide icons
    lucide.createIcons();
    
    const form = document.getElementById('verificationForm');
    const verifyBtn = document.getElementById('verifyBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const btnText = document.getElementById('btnText');
    const fileInput = document.getElementById('id_file');
    const fileNameSpan = document.getElementById('file-name');
    
    // Handle file input change
    if (fileInput) {
        fileInput.addEventListener('change', function(e) {
            const fileName = e.target.files.length > 0 ? e.target.files[0].name : 'Choose a file or drag and drop';
            fileNameSpan.textContent = fileName;
            
            // Add/remove classes based on file selection
            const fileLabel = fileInput.nextElementSibling;
            if (e.target.files.length > 0) {
                fileLabel.classList.add('border-blue-500', 'bg-blue-900/20');
                fileLabel.classList.remove('border-gray-500');
            } else {
                fileLabel.classList.remove('border-blue-500', 'bg-blue-900/20');
                fileLabel.classList.add('border-gray-500');
            }
        });
        
        // Handle drag and drop
        const fileLabel = fileInput.nextElementSibling;
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileLabel.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            fileLabel.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            fileLabel.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            fileLabel.classList.add('border-blue-500', 'bg-blue-900/30');
        }
        
        function unhighlight() {
            fileLabel.classList.remove('border-blue-500', 'bg-blue-900/30');
        }
        
        fileLabel.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) {
                fileInput.files = files;
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        }
    }
    const errorResult = document.getElementById('errorResult');
    const successResult = document.getElementById('successResult');
    
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading state
            verifyBtn.disabled = true;
            loadingSpinner.style.display = 'inline-block';
            btnText.innerHTML = 'Verifying...';
            errorResult.style.display = 'none';
            
            // Simulate API call (replace with actual implementation)
            setTimeout(() => {
                // This is where you'll integrate with GavaConnect API
                // For now, we'll simulate a response
                const idNumber = document.getElementById('idNumber').value;
                
                if (idNumber.length === 8) {
                    // Simulate successful verification
                    successResult.style.display = 'block';
                    form.style.display = 'none';
                } else {
                    // Simulate error
                    verifyBtn.disabled = false;
                    loadingSpinner.style.display = 'none';
                    btnText.innerHTML = '<i class="bi bi-shield-check me-2"></i>Verify Identity';
                    errorResult.style.display = 'block';
                }
            }, 2000);
        });
    }
    
    // Format phone number input
    const phoneInput = document.getElementById('phoneNumber');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('254')) {
                value = '+' + value;
            } else if (value.startsWith('0')) {
                value = '+254' + value.substring(1);
            } else if (value.length > 0 && !value.startsWith('+')) {
                value = '+254' + value;
            }
            e.target.value = value;
        });
    }
});
</script>
{% endblock %}
